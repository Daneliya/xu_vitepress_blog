---
title: å®æˆ˜3ï¼šå…‹éš†AIèŠå¤©åŠ©æ‰‹
tags:
  - Python
categories:
  - Python
---



## ä¸€ã€é¡¹ç›®ä»‹ç»

é¡¹ç›®çš„ç›®æ ‡æ˜¯å¼€å‘ä¸€ä¸ªä»¿ç…§ ChatGPTã€æ–‡å¿ƒä¸€è¨€çš„ AI èŠå¤©åŠ©æ‰‹ç½‘ç«™ï¼Œé‡ç‚¹å®ç° â€œå¸¦ä¸Šä¸‹æ–‡è®°å¿†çš„è¿ç»­å¯¹è¯â€ åŠŸèƒ½ï¼Œä»¥ä¸‹ä»**ç•Œé¢ç»“æ„ã€æ ¸å¿ƒäº¤äº’é€»è¾‘ã€å…³é”®åŠŸèƒ½äº®ç‚¹**ä¸‰æ–¹é¢æ•´ç†å…·ä½“æ•ˆæœï¼š

### 1ã€ç•Œé¢ç»“æ„ï¼šä¾§è¾¹æ  + ä¸»èŠå¤©åŒº

ç½‘ç«™ç•Œé¢åˆ†ä¸ºä¸¤å¤§æ ¸å¿ƒåŒºåŸŸï¼Œå¸ƒå±€ç®€æ´ä¸”ç¬¦åˆä¸»æµ AI èŠå¤©å·¥å…·çš„ä½¿ç”¨ä¹ æƒ¯ï¼š

1. å·¦ä¾§ä¾§è¾¹æ 
   - æ ¸å¿ƒåŠŸèƒ½ï¼šä¾›ç”¨æˆ·è¾“å…¥è‡ªå®šä¹‰ API å¯†é’¥ï¼ˆç”¨äºè°ƒç”¨ AI æ¨¡å‹ç”Ÿæˆå†…å®¹ï¼‰ã€‚
   - è¾…åŠ©åŠŸèƒ½ï¼šæä¾›å¯è·³è½¬çš„**OpenAI å®˜æ–¹ API å¯†é’¥è·å–é“¾æ¥**ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£å¦‚ä½•è·å–å¯†é’¥ï¼Œé™ä½ä½¿ç”¨é—¨æ§›ã€‚
2. ä¸»èŠå¤©åŒº

### 2ã€æ ¸å¿ƒäº¤äº’é€»è¾‘ï¼šå¯†é’¥éªŒè¯â†’è¿ç»­å¯¹è¯

æ•´ä¸ªåŠ©æ‰‹çš„äº¤äº’æµç¨‹å›´ç»• â€œå¯†é’¥æœ‰æ•ˆæ€§â€ å’Œ â€œä¸Šä¸‹æ–‡è®°å¿†â€ å±•å¼€ï¼Œæ­¥éª¤æ¸…æ™°ï¼š

#### 2.1ã€å‰ç½®ï¼šAPI å¯†é’¥éªŒè¯

- è‹¥ç”¨æˆ·æœªè¾“å…¥ API å¯†é’¥ï¼šèŠå¤©åŠŸèƒ½æ— æ³•å¼€å¯ï¼Œç³»ç»Ÿä¼šä¸»åŠ¨æé†’ â€œè¯·è¾“å…¥ API å¯†é’¥â€ï¼Œé¿å…å› å¯†é’¥ç¼ºå¤±å¯¼è‡´æ¨¡å‹è°ƒç”¨å¤±è´¥ã€‚
- è‹¥ç”¨æˆ·è¾“å…¥æœ‰æ•ˆ API å¯†é’¥ï¼šéªŒè¯é€šè¿‡åï¼ŒèŠå¤©åŠŸèƒ½è§£é”ï¼Œç”¨æˆ·å¯å¼€å§‹ä¸ AI åŠ©æ‰‹äº¤äº’ã€‚

#### 2.2ã€æ ¸å¿ƒï¼šå¸¦è®°å¿†çš„è¿ç»­å¯¹è¯

è¿™æ˜¯é¡¹ç›®ä¸‰ä¸å‰ä¸¤ä¸ªé¡¹ç›®ï¼ˆä»…æ”¯æŒä¸€æ¬¡æ€§äº’åŠ¨ï¼‰çš„æ ¸å¿ƒåŒºåˆ«ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š

- **å¤šè½®å¯¹è¯è¿è´¯æ€§**ï¼šç”¨æˆ·å¯å‘èµ·å¤šè½®è¿½é—®ï¼Œæ‰€æœ‰æ¶ˆæ¯ï¼ˆç”¨æˆ·æé—® + AI å›ç­”ï¼‰ä¼šæŒ‰æ—¶é—´é¡ºåºä¾æ¬¡å±•ç¤ºåœ¨ä¸»èŠå¤©åŒºï¼ˆæ–°æ¶ˆæ¯è‡ªåŠ¨è¿½åŠ åœ¨å†å²æ¶ˆæ¯ä¸‹æ–¹ï¼‰ã€‚
- ä¸Šä¸‹æ–‡è®°å¿†èƒ½åŠ›ï¼šAI èƒ½è¯†åˆ«å¹¶å…³è”å†å²å¯¹è¯ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š
  1. ç”¨æˆ·ç¬¬ä¸€è½®æé—® â€œç‰›é¡¿ç¬¬äºŒå®šå¾‹æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼ŒAI ç»™å‡ºè§£é‡Šï¼›
  2. ç”¨æˆ·ç¬¬äºŒè½®è¿½é—® â€œå®ƒçš„å…¬å¼å¦‚ä½•æ¨å¯¼ï¼Ÿâ€ï¼ŒAI ä¼šè‡ªåŠ¨è¯†åˆ« â€œå®ƒâ€ æŒ‡ä»£ â€œç‰›é¡¿ç¬¬äºŒå®šå¾‹â€ï¼ŒåŸºäºä¸Šä¸€è½®å†…å®¹ç»™å‡ºæ¨å¯¼è¿‡ç¨‹ï¼Œæ— éœ€ç”¨æˆ·é‡å¤è¯´æ˜ä¸»è¯­ã€‚

### 3ã€å…³é”®åŠŸèƒ½äº®ç‚¹

1. **ç”¨æˆ·è‡ªä¸»æ€§é«˜**ï¼šæ”¯æŒè‡ªå®šä¹‰ API å¯†é’¥ï¼Œç”¨æˆ·å¯ä½¿ç”¨è‡ªå·±çš„è´¦å·èµ„æºè°ƒç”¨æ¨¡å‹ï¼Œæ— éœ€ä¾èµ–é¡¹ç›®æ–¹æä¾›çš„ API æœåŠ¡ï¼Œçµæ´»åº¦æ›´é«˜ã€‚
2. **æ˜“ç”¨æ€§è®¾è®¡**ï¼šé€šè¿‡ â€œå®˜æ–¹é“¾æ¥æŒ‡å¼•â€â€œæ— å¯†é’¥æé†’â€ ç­‰ç»†èŠ‚ï¼Œé™ä½ç”¨æˆ·æ“ä½œæˆæœ¬ï¼Œå°¤å…¶é€‚åˆå¯¹ API å¯†é’¥è·å–ä¸ç†Ÿæ‚‰çš„æ–°æ‰‹ã€‚
3. **æ ¸å¿ƒèƒ½åŠ›çªç ´**ï¼šå®ç° â€œä¸Šä¸‹æ–‡è®°å¿†â€ï¼Œè§£å†³å‰åºé¡¹ç›® â€œå•æ¬¡äº’åŠ¨æ— å…³è”â€ çš„é—®é¢˜ï¼Œè®©å¯¹è¯æ›´è´´è¿‘çœŸå®äº¤æµåœºæ™¯ï¼ˆå¦‚æ—¥å¸¸å’¨è¯¢ã€çŸ¥è¯†é—®ç­”ã€ä»»åŠ¡åä½œç­‰ï¼‰ã€‚

## äºŒã€åˆ›å»ºAIè¯·æ±‚

### 1ã€å‰æœŸå‡†å¤‡ï¼šç¯å¢ƒæ­å»º

1. **åˆ›å»ºé¡¹ç›®ç»“æ„**ï¼š
   æ–°å»ºé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå°†`requirements.txt`æ–‡ä»¶æ”¾å…¥å…¶ä¸­ï¼ˆåŒ…å«é¡¹ç›®æ‰€éœ€ä¾èµ–ï¼‰ã€‚

   ~~~txt
   aiohttp==3.9.3
   aiosignal==1.3.1
   altair==5.2.0
   annotated-types==0.6.0
   anyio==4.3.0
   async-timeout==4.0.3
   attrs==23.2.0
   blinker==1.7.0
   cachetools==5.3.3
   certifi==2024.2.2
   charset-normalizer==3.3.2
   click==8.1.7
   dataclasses-json==0.6.4
   distro==1.9.0
   exceptiongroup==1.2.0
   frozenlist==1.4.1
   gitdb==4.0.11
   GitPython==3.1.42
   greenlet==3.0.3
   h11==0.14.0
   httpcore==1.0.4
   httpx==0.27.0
   idna==3.6
   Jinja2==3.1.3
   jsonpatch==1.33
   jsonpointer==2.4
   jsonschema==4.21.1
   jsonschema-specifications==2023.12.1
   langchain==0.1.12
   langchain-community==0.0.28
   langchain-core==0.1.31
   langchain-openai==0.0.8
   langchain-text-splitters==0.0.1
   langsmith==0.1.25
   markdown-it-py==3.0.0
   MarkupSafe==2.1.5
   marshmallow==3.21.1
   mdurl==0.1.2
   multidict==6.0.5
   mypy-extensions==1.0.0
   numpy==1.26.4
   openai==1.14.0
   orjson==3.9.15
   packaging==23.2
   pandas==2.2.1
   pillow==10.2.0
   protobuf==4.25.3
   pyarrow==15.0.1
   pydantic==2.6.4
   pydantic_core==2.16.3
   pydeck==0.8.1b0
   Pygments==2.17.2
   python-dateutil==2.9.0.post0
   pytz==2024.1
   PyYAML==6.0.1
   referencing==0.33.0
   regex==2023.12.25
   requests==2.31.0
   rich==13.7.1
   rpds-py==0.18.0
   six==1.16.0
   smmap==5.0.1
   sniffio==1.3.1
   SQLAlchemy==2.0.28
   streamlit==1.32.1
   tenacity==8.2.3
   tiktoken==0.6.0
   toml==0.10.2
   toolz==0.12.1
   tornado==6.4
   tqdm==4.66.2
   typing-inspect==0.9.0
   typing_extensions==4.10.0
   tzdata==2024.1
   urllib3==2.2.1
   yarl==1.9.4
   ~~~

2. **å®‰è£…ä¾èµ–**ï¼š
   åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤ï¼Œå®‰è£…æ‰€æœ‰ä¾èµ–åŒ…ï¼š

   ~~~sh
   pip install -r requirements.txt
   ~~~

3. **æ–°å»ºä»£ç æ–‡ä»¶**ï¼š
   åˆ›å»ºä¸€ä¸ª Python æ–‡ä»¶ï¼ˆ`utils.py`ï¼‰ï¼Œç”¨äºç¼–å†™ä¸ AI æ¨¡å‹äº¤äº’çš„æ ¸å¿ƒé€»è¾‘ã€‚

### 2ã€æ ¸å¿ƒå‡½æ•°

`utils.py`ä¸­å®šä¹‰`get_chat_response`å‡½æ•°ï¼Œå°è£…ä¸ AI æ¨¡å‹çš„äº¤äº’è¿‡ç¨‹ï¼Œå…³é”®æ˜¯ä¼ å…¥ â€œå¤–éƒ¨è®°å¿†â€ ä»¥ç»´æŒå¯¹è¯è¿è´¯æ€§ã€‚

#### å‡½æ•°å‚æ•°è®¾è®¡

å‡½æ•°éœ€æ¥æ”¶ 3 ä¸ªæ ¸å¿ƒå‚æ•°ï¼š

- `prompt`ï¼šç”¨æˆ·å½“å‰çš„è¾“å…¥æç¤ºï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚
- `openai_api_key`ï¼šç”¨æˆ·æä¾›çš„ API å¯†é’¥ï¼ˆç”¨äºè°ƒç”¨ AI æ¨¡å‹ï¼‰ã€‚
- `memory`ï¼šå¤–éƒ¨ä¼ å…¥çš„è®°å¿†å®ä¾‹ï¼ˆå‚¨å­˜å†å²å¯¹è¯ï¼Œç¡®ä¿è·¨å‡½æ•°è°ƒç”¨æ—¶è®°å¿†ä¸ä¸¢å¤±ï¼‰ã€‚

#### å‡½æ•°å†…éƒ¨é€»è¾‘

`utils.py`å®Œæ•´ä»£ç 

~~~python
from langchain.chains import ConversationChain
from langchain_openai import ChatOpenAI

import os
from langchain.memory import ConversationBufferMemory


def get_chat_response(prompt, memory, openai_api_key):
    model = ChatOpenAI(model="gpt-3.5-turbo", openai_api_key=openai_api_key)
    chain = ConversationChain(llm=model, memory=memory)

    response = chain.invoke({"input": prompt})
    return response["response"]
~~~

#### å…³é”®é€»è¾‘è§£æ

1. **æ¨¡å‹åˆå§‹åŒ–**ï¼š
   ä½¿ç”¨`ChatOpenAI`åˆ›å»ºæ¨¡å‹å®ä¾‹ï¼Œé€šè¿‡`openai_api_key`å‚æ•°ä¼ å…¥ç”¨æˆ·æä¾›çš„å¯†é’¥ï¼Œç¡®ä¿æ¨¡å‹è°ƒç”¨æƒé™ã€‚
2. **å¯¹è¯é“¾ä¸è®°å¿†å…³è”**ï¼š
   `ConversationChain`è‡ªåŠ¨å¤„ç† â€œåŠ è½½å†å²è®°å¿†â†’ç”Ÿæˆå›åº”â†’æ›´æ–°è®°å¿†â€ çš„å…¨æµç¨‹ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨`load_memory_variables`æˆ–`save_context`ï¼Œç®€åŒ–é€»è¾‘å¹¶å‡å°‘å‡ºé”™æ¦‚ç‡ã€‚
3. **å›åº”æå–**ï¼š
   å¯¹è¯é“¾çš„`invoke`æ–¹æ³•è¿”å›å­—å…¸ï¼ˆå«`input`ã€`history`ã€`response`ç­‰å­—æ®µï¼‰ï¼Œä»…æå–`response`å­—æ®µï¼ˆAI çš„å›ç­”å†…å®¹ï¼‰ä½œä¸ºå‡½æ•°è¿”å›å€¼ï¼Œç¬¦åˆå®é™…éœ€æ±‚ã€‚

### 3ã€åŠŸèƒ½æµ‹è¯•ï¼šéªŒè¯è®°å¿†æœ‰æ•ˆæ€§

ä¸ºç¡®ä¿å‡½æ•°èƒ½ç»´æŒå¯¹è¯è®°å¿†ï¼Œéœ€è¿›è¡Œå¤šè½®è°ƒç”¨æµ‹è¯•ï¼Œåœ¨`utils.py`ä¸­å¢åŠ å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š

~~~python
memory = ConversationBufferMemory(return_messages=True)
print(get_chat_response("ç‰›é¡¿æå‡ºè¿‡å“ªäº›çŸ¥åçš„å®šå¾‹ï¼Ÿ", memory, os.getenv("OPENAI_API_KEY")))
print(get_chat_response("æˆ‘ä¸Šä¸€ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ", memory, os.getenv("OPENAI_API_KEY")))
~~~

#### æµ‹è¯•é¢„æœŸç»“æœ

- ç¬¬ä¸€è½®ï¼šAI æ­£ç¡®å›ç­”ç‰›é¡¿ç¬¬äºŒå®šå¾‹çš„å†…å®¹ã€‚
- ç¬¬äºŒè½®ï¼šAI èƒ½è¯†åˆ« â€œå®ƒâ€ æŒ‡ä»£ â€œç‰›é¡¿ç¬¬äºŒå®šå¾‹â€ï¼ŒåŸºäºå†å²å¯¹è¯ç»™å‡ºå…¬å¼ï¼Œè¯æ˜è®°å¿†ç”Ÿæ•ˆï¼ˆå¯¹è¯è¿è´¯æ€§æˆç«‹ï¼‰ã€‚

### 4ã€æ ¸å¿ƒäº®ç‚¹

1. **è®°å¿†å¤–éƒ¨åŒ–**ï¼šè®°å¿†å®ä¾‹ä»å¤–éƒ¨ä¼ å…¥å‡½æ•°ï¼Œè€Œéåœ¨å‡½æ•°å†…éƒ¨åˆå§‹åŒ–ï¼Œç¡®ä¿å¤šè½®è°ƒç”¨æ—¶å†å²å¯¹è¯ä¸ä¸¢å¤±ï¼Œæ˜¯å®ç°è¿ç»­å¯¹è¯çš„å…³é”®ã€‚
2. **æµç¨‹è‡ªåŠ¨åŒ–**ï¼šå€ŸåŠ©`ConversationChain`è‡ªåŠ¨å¤„ç†è®°å¿†åŠ è½½ä¸æ›´æ–°ï¼Œé¿å…æ‰‹åŠ¨æ“ä½œå¯èƒ½çš„é—æ¼æˆ–é”™è¯¯ã€‚
3. **çµæ´»æ€§**ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ API å¯†é’¥ï¼Œæ¨¡å‹å‹å·å¯è°ƒæ•´ï¼Œé€‚é…ä¸åŒåœºæ™¯éœ€æ±‚ã€‚

## ä¸‰ã€åˆ›å»ºç½‘ç«™é¡µé¢

é€šè¿‡ Streamlit æ„å»ºèŠå¤©åŠ©æ‰‹çš„å‰ç«¯ç•Œé¢ï¼Œå®ç° â€œAPI å¯†é’¥è¾“å…¥â†’å¯¹è¯å±•ç¤ºâ†’ç”¨æˆ·äº¤äº’â€ çš„å®Œæ•´åŠŸèƒ½ï¼Œæœ€ç»ˆæ‰“é€ ä¸€ä¸ªå¯éƒ¨ç½²ã€æ”¯æŒè¿è´¯å¯¹è¯çš„ä»¿ ChatGPT ç½‘ç«™ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†å®ç°æ­¥éª¤ä¸è§£æï¼š

### 1ã€å‰æœŸå‡†å¤‡ï¼šä»£ç ç»“æ„ä¸ä¾èµ–

1. **æ¸…ç†æµ‹è¯•ä»£ç **ï¼š
   åˆ é™¤æˆ–æ³¨é‡Šæ‰`utils.py`ä¸­`get_chat_response`å‡½æ•°çš„æµ‹è¯•ä»£ç ï¼ˆé¿å…å¹²æ‰°å‰ç«¯è°ƒç”¨ï¼‰ã€‚
2. **æ–°å»ºå‰ç«¯æ–‡ä»¶**ï¼š
   åˆ›å»ºå‰ç«¯ä»£ç æ–‡ä»¶ï¼ˆå¦‚`main.py`ï¼‰ï¼Œä½œä¸ºç½‘ç«™ä¸»é¡µå…¥å£ã€‚
3. **å¯¼å…¥æ ¸å¿ƒåº“**ï¼š
   éœ€å¯¼å…¥ Streamlitï¼ˆæ„å»ºå‰ç«¯ï¼‰å’Œåç«¯çš„`get_chat_response`å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š

~~~python
import streamlit as st
from langchain.memory import ConversationBufferMemory

from utils import get_chat_response
~~~

### 2ã€å‰ç«¯ç•Œé¢æ­å»ºï¼šåˆ†æ¨¡å—å®ç°

#### 2.1ã€é¡µé¢æ ‡é¢˜ä¸åŸºç¡€é…ç½®

è®¾ç½®ç½‘ç«™æ ‡é¢˜ï¼Œæå‡è§†è§‰è¾¨è¯†åº¦ï¼š

~~~python
st.title("ğŸ’¬ å…‹éš†ChatGPT")
~~~

#### 2.2ã€ä¾§è¾¹æ ï¼šAPI å¯†é’¥è¾“å…¥

æ·»åŠ ä¾§è¾¹æ ç”¨äºç”¨æˆ·è¾“å…¥ API å¯†é’¥ï¼ˆå¤ç”¨å‰åºé¡¹ç›®é€»è¾‘ï¼Œç¡®ä¿å®‰å…¨æ€§ä¸è‡ªä¸»æ€§ï¼‰ï¼š

~~~python
with st.sidebar:
    openai_api_key = st.text_input("è¯·è¾“å…¥OpenAI API Keyï¼š", type="password")
    st.markdown("[è·å–OpenAI API key](https://platform.openai.com/account/api-keys)")
~~~

#### 2.3ã€ä¼šè¯çŠ¶æ€åˆå§‹åŒ–ï¼šè§£å†³ â€œè®°å¿†é‡ç½®â€ é—®é¢˜

Streamlit æœ‰ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼š**ç”¨æˆ·äº¤äº’ï¼ˆå¦‚è¾“å…¥ã€ç‚¹å‡»æŒ‰é’®ï¼‰æˆ–ä»£ç ä¿®æ”¹åï¼Œä¼šä»å¤´é‡æ–°è¿è¡Œä»£ç **ã€‚è‹¥ç›´æ¥åˆå§‹åŒ–è®°å¿†ï¼Œä¼šå¯¼è‡´æ¯è½®å¯¹è¯åè®°å¿†è¢«æ¸…ç©ºï¼Œæ— æ³•ç»´æŒè¿è´¯æ€§ã€‚

è§£å†³æ–¹æ¡ˆï¼šåˆ©ç”¨`st.session_state`ï¼ˆä¼šè¯çŠ¶æ€ï¼‰å‚¨å­˜è®°å¿†å’Œå¯¹è¯å†å²ï¼Œä»…åœ¨é¦–æ¬¡åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œåç»­å¤ç”¨å·²æœ‰çŠ¶æ€ï¼š

~~~python
if "memory" not in st.session_state:
    st.session_state["memory"] = ConversationBufferMemory(return_messages=True)
    st.session_state["messages"] = [{"role": "ai",
                                     "content": "ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}]
~~~

#### 2.4ã€å¯¹è¯å†å²å±•ç¤ºï¼šåŒºåˆ†è§’è‰²ä¸å†…å®¹

é€šè¿‡å¾ªç¯è¿­ä»£`st.session_state.messages`ï¼Œåˆ©ç”¨ Streamlit çš„`st.chat_message`å‡½æ•°å±•ç¤ºå¯¹è¯ï¼Œè‡ªåŠ¨åŒºåˆ† â€œAIâ€ å’Œ â€œäººç±»â€ è§’è‰²ï¼ˆå«é»˜è®¤å›¾æ ‡ï¼‰ï¼š

~~~python
for message in st.session_state["messages"]:
    st.chat_message(message["role"]).write(message["content"])
~~~

#### 2.5ã€ç”¨æˆ·è¾“å…¥æ¡†ï¼šæ¥æ”¶æ¶ˆæ¯å¹¶è§¦å‘å¯¹è¯

ä½¿ç”¨`st.chat_input`åˆ›å»ºç”¨æˆ·è¾“å…¥æ¡†ï¼Œå®ç° â€œè¾“å…¥â†’éªŒè¯â†’è°ƒç”¨åç«¯â†’å±•ç¤ºå›åº”â€ çš„æµç¨‹ï¼š

~~~python
# ç”¨æˆ·è¾“å…¥æ¡†ï¼šè·å–ç”¨æˆ·æ¶ˆæ¯
prompt = st.chat_input()
if prompt:
    # 1. éªŒè¯APIå¯†é’¥ï¼šæ— å¯†é’¥åˆ™æç¤ºå¹¶ç»ˆæ­¢
    if not openai_api_key:
        st.info("è¯·è¾“å…¥ä½ çš„OpenAI API Key")
        st.stop()
	
    # 2. å‚¨å­˜å¹¶å±•ç¤ºç”¨æˆ·æ¶ˆæ¯
    # åŠ å…¥å¯¹è¯å†å²
    st.session_state["messages"].append({"role": "human", "content": prompt})
    # å‰ç«¯å±•ç¤ºç”¨æˆ·æ¶ˆæ¯
    st.chat_message("human").write(prompt)
    
	# 3. è°ƒç”¨åç«¯å‡½æ•°è·å–AIå›åº”ï¼ˆå¸¦åŠ è½½æç¤ºï¼‰
    with st.spinner("AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨ç­‰..."):
        # ä¼ å…¥ä¼šè¯çŠ¶æ€ä¸­çš„è®°å¿†ï¼Œç»´æŒè¿è´¯æ€§
        response = get_chat_response(prompt, st.session_state["memory"],
                                     openai_api_key)
    
    # 4. å‚¨å­˜å¹¶å±•ç¤ºAIå›åº”
    msg = {"role": "ai", "content": response}
    # åŠ å…¥å¯¹è¯å†å²
    st.session_state["messages"].append(msg)
    # å‰ç«¯å±•ç¤ºAIå›åº”
    st.chat_message("ai").write(response)
~~~

#### 2.6ã€å®Œæ•´ä»£ç 

`main.py`

~~~python
import streamlit as st
from langchain.memory import ConversationBufferMemory

from utils import get_chat_response

st.title("ğŸ’¬ å…‹éš†ChatGPT")

with st.sidebar:
    openai_api_key = st.text_input("è¯·è¾“å…¥OpenAI API Keyï¼š", type="password")
    st.markdown("[è·å–OpenAI API key](https://platform.openai.com/account/api-keys)")

if "memory" not in st.session_state:
    st.session_state["memory"] = ConversationBufferMemory(return_messages=True)
    st.session_state["messages"] = [{"role": "ai",
                                     "content": "ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}]

for message in st.session_state["messages"]:
    st.chat_message(message["role"]).write(message["content"])

prompt = st.chat_input()
if prompt:
    if not openai_api_key:
        st.info("è¯·è¾“å…¥ä½ çš„OpenAI API Key")
        st.stop()
    st.session_state["messages"].append({"role": "human", "content": prompt})
    st.chat_message("human").write(prompt)

    with st.spinner("AIæ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨ç­‰..."):
        response = get_chat_response(prompt, st.session_state["memory"],
                                     openai_api_key)
    msg = {"role": "ai", "content": response}
    st.session_state["messages"].append(msg)
    st.chat_message("ai").write(response)
~~~



### 3ã€åŠŸèƒ½æµ‹è¯•ä¸éªŒè¯

1. **è¿è¡Œå‰ç«¯**ï¼š
   å¯åŠ¨ Streamlit æœåŠ¡
2. **æµ‹è¯•æµç¨‹**ï¼š
   - æ­¥éª¤ 1ï¼šåœ¨ä¾§è¾¹æ è¾“å…¥ OpenAI API å¯†é’¥ã€‚
   - æ­¥éª¤ 2ï¼šåœ¨è¾“å…¥æ¡†å‘é€é—®é¢˜ï¼ˆå¦‚ â€œç‰›é¡¿ç¬¬äºŒå®šå¾‹æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼‰ï¼Œè§‚å¯Ÿ AI å›åº”æ˜¯å¦å±•ç¤ºã€‚
   - æ­¥éª¤ 3ï¼šç»§ç»­è¿½é—®ï¼ˆå¦‚ â€œå®ƒçš„å…¬å¼æ˜¯ä»€ä¹ˆï¼Ÿâ€ï¼‰ï¼ŒéªŒè¯ AI æ˜¯å¦èƒ½å…³è”å†å²å¯¹è¯ï¼ˆè®°å¿†ç”Ÿæ•ˆï¼‰ã€‚
3. **é¢„æœŸæ•ˆæœ**ï¼š
   - å¯¹è¯æŒ‰ â€œç”¨æˆ·â†’AIâ€ é¡ºåºå±•ç¤ºï¼Œè§’è‰²æ°”æ³¡æ¸…æ™°åŒºåˆ†ã€‚
   - å¤šè½®è¿½é—®æ—¶ï¼ŒAI èƒ½ç†è§£ä¸Šä¸‹æ–‡ï¼ˆå¦‚ â€œå®ƒâ€ æŒ‡ä»£å‰åºé—®é¢˜ä¸­çš„ â€œç‰›é¡¿ç¬¬äºŒå®šå¾‹â€ï¼‰ã€‚

### 4ã€å¯é€‰åŠŸèƒ½ï¼šå¯¹è¯æ¸…ç©ºï¼ˆæŒ‘æˆ˜ä»»åŠ¡ï¼‰

ä¸ºæå‡ç”¨æˆ·ä½“éªŒï¼Œå¯æ·»åŠ  â€œæ¸…ç©ºå¯¹è¯â€ æŒ‰é’®ï¼Œå®ç° â€œé‡ç½®è®°å¿† + æ¸…ç©ºå†å²â€ çš„åŠŸèƒ½ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

~~~python
# åœ¨ä¾§è¾¹æ æ·»åŠ â€œæ¸…ç©ºå¯¹è¯â€æŒ‰é’®
with st.sidebar:
    if st.button("æ¸…ç©ºå¯¹è¯"):
        # é‡ç½®è®°å¿†å’Œå¯¹è¯å†å²
        st.session_state.memory = ConversationBufferMemory(return_messages=True)
        st.session_state.messages = [{"role": "ai", "content": "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ"}]
        st.rerun()  # é‡æ–°åŠ è½½é¡µé¢ï¼Œç”Ÿæ•ˆæ¸…ç©ºæ“ä½œ
~~~

### 5ã€æ ¸å¿ƒäº®ç‚¹

1. **ä¼šè¯çŠ¶æ€ç®¡ç†**ï¼šé€šè¿‡`st.session_state`è§£å†³ Streamlit ä»£ç é‡è·‘å¯¼è‡´çš„ â€œè®°å¿†ä¸¢å¤±â€ é—®é¢˜ï¼Œæ˜¯å®ç°è¿è´¯å¯¹è¯çš„å…³é”®ã€‚
2. **è§’è‰²åŒ–å±•ç¤º**ï¼šåˆ©ç”¨`st.chat_message`è‡ªåŠ¨åŒºåˆ† AI ä¸äººç±»è§’è‰²ï¼Œç•Œé¢è´´è¿‘ ChatGPT ç­‰ä¸»æµå·¥å…·ï¼Œç”¨æˆ·ä½“éªŒå‹å¥½ã€‚
3. **æµç¨‹å®Œæ•´æ€§**ï¼šåŒ…å« â€œå¯†é’¥éªŒè¯â†’åŠ è½½æç¤ºâ†’å¯¹è¯å‚¨å­˜â†’å›åº”å±•ç¤ºâ€ å…¨æµç¨‹ï¼Œé€»è¾‘é—­ç¯ä¸”å®¹é”™æ€§å¼ºï¼ˆå¦‚æ— å¯†é’¥æ—¶æç¤ºï¼‰ã€‚

### 6ã€éƒ¨ç½²ä¸æ‰©å±•ï¼ˆåç»­æ–¹å‘ï¼‰

- **éƒ¨ç½²**ï¼šå¯é€šè¿‡ Streamlit Community Cloudï¼ˆå…è´¹ï¼‰ã€Heroku ç­‰å¹³å°éƒ¨ç½²ç½‘ç«™ï¼Œç”Ÿæˆå…¬å¼€é“¾æ¥ä¾›ä»–äººä½¿ç”¨ã€‚
- **æ‰©å±•**ï¼šå¯æ·»åŠ  â€œæ¨¡å‹é€‰æ‹©â€ï¼ˆå¦‚ GPT-3.5/GPT-4ï¼‰ã€â€œå¯¹è¯å¯¼å‡ºâ€ï¼ˆä¿å­˜ä¸º TXT/CSVï¼‰ç­‰åŠŸèƒ½ï¼Œæå‡å·¥å…·å®ç”¨æ€§ã€‚